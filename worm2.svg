<?xml version="1.0" encoding="UTF-8" standalone="no" ?> 
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/SVG/DTD/svg10.dtd"> 
<svg xmlns="http://www.w3.org/2000/svg" 
onload="startup(evt)" >
<!-- Author: Jan van der Meiden                                           -->
<!-- jvdmeiden@gmail.com                                                  -->
<!-- Version: 20140308.00                                                 -->
<!-- Copyright (c) 2014 Jan van der Meiden.                               -->
<!-- Copying and distribution of this file, with or without modification, -->
<!-- are permitted in any medium without royalty provided the copyright   -->
<!-- notice and this notice are preserved.                                -->

<script><![CDATA[
var SVGDoc = null;
var lineRoot = null;
var sq3=Math.sqrt(3);
var increment = 8;
var svgns = 'http://www.w3.org/2000/svg';
// the field contains information on what was eaten where, heavily relying on associative arrays
var field = new Object;
// currently allowing one worm, has x and y positiom and direction
var worm = [0,0,0];
var offsetX = window.innerWidth/2;
var offsetY = window.innerHeight/2;
// types follow naming as described by Martin Gardner Mathematical Games
var type = "1a2d3cbaa4b";
var dirs = [[1,0],[1,-1],[0,-1],[-1,0],[-1,1],[0,1]];
  
function startup(evt){
  SVGDoc = evt.target.ownerDocument;
  lineRoot = SVGDoc.getElementById("Lines"); 
  t=setTimeout("tick()",50);
  }

function tick(evt){ 
   console.log(JSON.stringify(field));
   console.log(JSON.stringify(worm));
  var x = worm[0];
  var y = worm[1];
  var v = worm[2];
  // based on direction find the next field  
  var xn = x + dirs[v][0];
  var yn = y + dirs[v][1];
  
  // check if current and next field exist if not create
  if (field[x] === undefined) {
    field[x]=({});
  }
  if (field[x][y] === undefined) {
	field[x][y]=[false,false,false,false,false,false];
  }

  if (field[xn] === undefined) {
    field[xn]=({});
  }
  if (field[xn][yn] === undefined) {
    field[xn][yn]=[false,false,false,false,false,false];
  }
  
  // draw the line and update field 
  draw(x,y,xn,yn);
  field[xn][yn][v]=true;
  field[x][y][(v+3)%6]=true;
  // update worm based on type, eg "1a2d3cbaa4b"
  worm[0]=xn;
  worm[1]=yn;
  odir=worm[2];
  var cnt=0;
  field[xn][yn].forEach( function(e){
    if ( e == true ) cnt += 1;
  });
  console.log(cnt);
  if (cnt==1){
    console.log(type.charAt(1));
    if ( type.charAt(1)=='a' ) worm[2]=(4+odir)%6; 
	if ( type.charAt(1)=='b' ) worm[2]=(5+odir)%6;
	if ( type.charAt(1)=='c' ) worm[2]=(2+odir)%6;
	if ( type.charAt(1)=='a' ) worm[2]=(1+odir)%6;
  }
  if (cnt==2){
    console.log(type.charAt(3));
    if ( type.charAt(3)== 'a' ) {
	  if (field[xn][yn][(odir+5)%6]== true) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== true) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true) worm[2]=(1+odir)%6;
      if (field[xn][yn][(odir+1)%6]== true) worm[2]=(2+odir)%6; 
	}	  
    if ( type.charAt(3)== 'b' ) {
	  if (field[xn][yn][(odir+5)%6]== true) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== true) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true) worm[2]=(3+odir)%6;
      if (field[xn][yn][(odir+1)%6]== true) worm[2]=(3+odir)%6; 
	}	  
    if ( type.charAt(3)== 'c' ) {
	  if (field[xn][yn][(odir+5)%6]== true) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== true) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true) worm[2]=(4+odir)%6;
      if (field[xn][yn][(odir+1)%6]== true) worm[2]=(4+odir)%6; 
	}	  
    if ( type.charAt(3)== 'd' ) {
	  if (field[xn][yn][(odir+5)%6]== true) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== true) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true) worm[2]=(5+odir)%6;
      if (field[xn][yn][(odir+1)%6]== true) worm[2]=(5+odir)%6; 
	}	  
  }
  if (cnt==3){
    console.log(type.charAt(5));  
    if ( type.charAt(5)== 'a' ) {
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+2)%6]== true  ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(5+odir)%6;
	}	  
    if ( type.charAt(5)== 'b' ) {
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+2)%6]== true  ) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(2+odir)%6;
	}	  
    if ( type.charAt(5)== 'c' ) {
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+2)%6]== true  ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(4+odir)%6;
	}	  
    console.log(type.charAt(6));  
    if ( type.charAt(6)== 'a' ) {
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(3+odir)%6;
	}	  
    if ( type.charAt(6)== 'b' ) {
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(2+odir)%6;
	}	  
    if ( type.charAt(6)== 'c' ) {
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+3)%6]== true  ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(4+odir)%6;
	}	  
    console.log(type.charAt(7));  
    if ( type.charAt(7)== 'a' ) {
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(3+odir)%6;
	}	  
    if ( type.charAt(7)== 'b' ) {
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(1+odir)%6;
	}	  
    if ( type.charAt(7)== 'c' ) {
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(5+odir)%6;
	}	  
    console.log(type.charAt(8));  
    if ( type.charAt(8)== 'a' ) {
	  if (field[xn][yn][(odir+4)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+4)%6]== true  ) worm[2]=(1+odir)%6;
	}	  
    if ( type.charAt(8)== 'b' ) {
	  if (field[xn][yn][(odir+4)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(2+odir)%6;
	}	  
    if ( type.charAt(8)== 'c' ) {
	  if (field[xn][yn][(odir+4)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== true && field[xn][yn][(odir+5)%6]== true  ) worm[2]=(4+odir)%6;
	}	  
  }  
  if (cnt==4){
    console.log(type.charAt(10));  
    if ( type.charAt(10)== 'a' ) {
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+2)%6]== false ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+3)%6]== false ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(1+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+3)%6]== false ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(4+odir)%6;
	}	  
    if ( type.charAt(10)== 'b' ) {
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+2)%6]== false ) worm[2]=(2+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+3)%6]== false ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+1)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+3)%6]== false ) worm[2]=(3+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+2)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== false && field[xn][yn][(odir+4)%6]== false ) worm[2]=(4+odir)%6;
	  if (field[xn][yn][(odir+3)%6]== false && field[xn][yn][(odir+3)%6]== false ) worm[2]=(5+odir)%6;
	  if (field[xn][yn][(odir+4)%6]== false && field[xn][yn][(odir+5)%6]== false ) worm[2]=(5+odir)%6;
	}	  
  }  

  
  
  if ( cnt != 5 ) t=setTimeout("tick()",500); 
}   

function draw(x1,y1,x2,y2){
  NewLine = SVGDoc.createElementNS(svgns,"line"); 
  NewLine.setAttribute("x1", offsetX+increment*(x1+y1/2)); 
  NewLine.setAttribute("y1", offsetY-sq3*increment*y1/2); 
  NewLine.setAttribute("x2", offsetX+increment*(x2+y2/2)); 
  NewLine.setAttribute("y2", offsetY-sq3*increment*y2/2); 
  NewLine.setAttribute("width", 1); 
  NewLine.setAttribute("stroke","rgb(50,50,50)"); 
  lineRoot.appendChild(NewLine); 
}

]]></script> 

<rect x="0" y="0" width="100%" height="100%" 
	fill="#e0e0e0" /> 
 <g id="Lines">
 </g>
</svg> 